(function($) {
	$(document).ready(function() {
		if($('#product-fullwidth').length) {
			var svg = '<svg id="grill-builder-teeth" data-name="Grill Builder Teeth" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 163.5"><defs><linearGradient id="yellow-gold" x1="0%" x2="100%" y1="100%" y2="0%"><stop offset="0%" stop-color="#ba994c" /><stop offset="100%" stop-color="#f3dfa1" /></linearGradient><linearGradient id="rose-gold" x1="0%" x2="100%" y1="100%" y2="0%"><stop offset="0%" stop-color="#af7069" /><stop offset="100%" stop-color="#fec4b8" /></linearGradient><linearGradient id="white-gold" x1="0%" x2="100%" y1="100%" y2="0%"><stop offset="0%" stop-color="#bfbfbf" /><stop offset="100%" stop-color="#ffffff" /></linearGradient><linearGradient id="silver"><stop offset="0%" stop-color="#bfbfbf" /><stop offset="100%" stop-color="#ffffff" /></linearGradient></defs><path class="top-row top-1 cls-1" d="M28.25,36.59a9.34,9.34,0,0,0-4.9.55,5.22,5.22,0,0,0-2.48,4.1,26,26,0,0,0-.17,4l0,2.56a9.74,9.74,0,0,0,.13,1.79c.14.74.45,1.45.62,2.19.26,1.14.17,2.32.36,3.48s.77,2.57.88,3.88a6.49,6.49,0,0,0,.42,2.74,3.83,3.83,0,0,0,2.18,1.6,13.27,13.27,0,0,0,2.9.54,2.45,2.45,0,0,0,1.48-.16,1.4,1.4,0,0,0,.51-1.5,21.59,21.59,0,0,0-.9-3.11,21.45,21.45,0,0,1-.38-9.23c.43-3.08,1.18-6.12,1.56-9.21a5.55,5.55,0,0,0-.09-2.4,3.29,3.29,0,0,0-2.14-1.86"/><path class="top-row top-2 cls-1" d="M33.82,36.08a3.11,3.11,0,0,0-3,1.22,6.3,6.3,0,0,0-1,3,38.82,38.82,0,0,0-.4,7.46,1.53,1.53,0,0,0-.63,1.43c0,1.77-.08,3.53-.09,5.3a17.57,17.57,0,0,0,.18,3.24,23.69,23.69,0,0,1,.61,3.41,12.07,12.07,0,0,0,0,1.7,6.16,6.16,0,0,0,.86,2.08A3.75,3.75,0,0,0,31.12,66a4.54,4.54,0,0,0,2,.77,8.79,8.79,0,0,0,4.8,0,8.29,8.29,0,0,0,2-1.29,2.29,2.29,0,0,0,.63-.65,1.61,1.61,0,0,0,.16-.78,19.72,19.72,0,0,0-.43-2.93,36,36,0,0,1,0-6.14c.07-4.63-1-9.3-.08-13.85a4.11,4.11,0,0,0,.06-2.5,3.92,3.92,0,0,0-2.54-1.82,16.77,16.77,0,0,0-3.93-.68"/><path class="top-row top-3 cls-1" d="M43.69,37.06a3.91,3.91,0,0,0-3.22,1.54,4,4,0,0,0-.88,3.53c.07.33.19.64.23,1a4.72,4.72,0,0,1-.07,1c-.54,3.91.36,7.88.19,11.82a20.72,20.72,0,0,0,0,3.52c.11.9.38,1.77.57,2.65.43,2,.4,4,.83,6A6.93,6.93,0,0,0,44.58,73a7,7,0,0,0,3.19.59,25.49,25.49,0,0,0,5.06-.78c2.18-.49,4.6-1.15,5.69-3.06l-.93-4.5a33.18,33.18,0,0,1-.65-4,24.31,24.31,0,0,1,.18-4.82c.1-.84.22-1.67.34-2.51l.38-2.72L58,50.5c.2-1.45.41-2.91.56-4.37.23-2.19.27-4.57-1-6.38-1.39-2-4-2.75-6.47-2.84s-4.91.36-7.35.15"/><path class="top-row top-4 cls-1" d="M68.18,36.92c-2,0-2.91,0-4.88,0a3.17,3.17,0,0,0-2.41.64,3.07,3.07,0,0,0-.59,1.2,69.06,69.06,0,0,0-3.19,21.59,27.2,27.2,0,0,0,.67,6.37c.42,1.68,1.1,3.29,1.4,5A6,6,0,0,0,59.49,73a3.67,3.67,0,0,0,.83,1.12c2.58,2.54,6.49,3.05,10.1,3.42l3.91.41a12.07,12.07,0,0,0,2.55.08c2.07-.24,3.84-1.55,5.49-2.82a1.51,1.51,0,0,0,.58-.65c.17-.48-.17-1-.41-1.43A7.91,7.91,0,0,1,82,68.87q.52-10.2,1.68-20.37a5.34,5.34,0,0,0,0-2.07,5.15,5.15,0,0,0-.95-1.69c-2.2-3-4.68-6.1-8.22-7.25A18.62,18.62,0,0,0,68.18,36.92Z"/><path class="top-row top-5 cls-1" d="M84.62,45.63C84.26,49,83,52.1,82.79,55.43l-.54,7.78a43,43,0,0,0-.09,7.35,32.16,32.16,0,0,0,.8,4.36c.72,2.92,1.92,6.1,4.62,7.34a10.57,10.57,0,0,0,3.58.72l18,1.53a25.3,25.3,0,0,0,3.48.12,12.12,12.12,0,0,0,4.89-1.35,5.39,5.39,0,0,0,2.65-2.55,7.24,7.24,0,0,0,.38-2.22l1.17-19.75a41.37,41.37,0,0,0,.1-4.59,20.34,20.34,0,0,0-1.63-7A8.89,8.89,0,0,0,117,43.06a10.38,10.38,0,0,0-3.53-1.19c-7.89-1.54-16-1.69-24-1.82a5.72,5.72,0,0,0-2.57.34C85,41.24,84.84,43.58,84.62,45.63Z"/><path class="top-row top-6 cls-2" d="M121.19,52.35c-.52-1.72.24-4.31.83-6a6.1,6.1,0,0,1,4.53-4.26,28.55,28.55,0,0,1,6.3-1.08l15.91-1.55a10.07,10.07,0,0,1,4.06.17,7.52,7.52,0,0,1,4,3.94A25.86,25.86,0,0,1,159,51a132.72,132.72,0,0,1,1.81,17.79,26.66,26.66,0,0,1-.51,7.36,10.31,10.31,0,0,1-3.92,6.09,12.53,12.53,0,0,1-5,1.76,63.55,63.55,0,0,1-10.69.62H130.8a21.62,21.62,0,0,1-4.89-.37,7.27,7.27,0,0,1-4.16-2.43c-1.6-2-1.53-4.9-1.37-7.5l1-18A11.31,11.31,0,0,0,121.19,52.35Z"/><path class="top-row top-7 cls-2" d="M157.72,47.64c-.35-1.82.92-3.61,1.75-5.27a8.7,8.7,0,0,1,3.73-4,13,13,0,0,1,4.55-1l7.12-.72a5.49,5.49,0,0,1,3.59.46,5,5,0,0,1,1.44,1.75c4.18,7.33,4.73,16.14,4.6,24.58a22.78,22.78,0,0,1-.32,4c-.3,1.47-.87,2.86-1.27,4.31-.7,2.51-1,5.35-2.85,7.18a7.8,7.8,0,0,1-2.53,1.57c-4.74,2-10.1,1.19-15.15.39a4,4,0,0,1-2.45-1c-1-1.08-.47-2.73-.17-4.14a23.24,23.24,0,0,0,.39-3.73C160.48,64.23,159.23,55.31,157.72,47.64Z"/><path class="top-row top-8 cls-2" d="M182.71,46.13c-.56-2.8,1.69-5.47,3.75-7.45a5.92,5.92,0,0,1,2-1.38,6.68,6.68,0,0,1,2-.3q4.11-.18,8.22-.17c1.55,0,3.26.1,4.39,1.16a5.69,5.69,0,0,1,1.43,3.08,30.42,30.42,0,0,1,.68,4.94,60.71,60.71,0,0,1-.15,7l-.37,6.39a120.18,120.18,0,0,1-1.27,13.26,10.82,10.82,0,0,1-1.18,3.79A7.67,7.67,0,0,1,197,79.82a16,16,0,0,1-6.34-.34,12.47,12.47,0,0,1-4.78-1.9,5.5,5.5,0,0,1-2.41-4.36,10,10,0,0,1,.5-2.47C186.15,63,184.29,54.05,182.71,46.13Z"/><path class="top-row top-9 cls-2" d="M205.55,42.17c-.46-1.74,2.38-3.88,4.16-4.14a4.74,4.74,0,0,1,4.69,2,7.54,7.54,0,0,1,.83,3.39c.16,2.16.26,4.34.34,6.51a76,76,0,0,1-.37,13.32,28.57,28.57,0,0,1-4.53,12.41,3.41,3.41,0,0,1-1.35,1.29,3.75,3.75,0,0,1-2.71-.3l-2-.74a2,2,0,0,1-1.26-.93,2.1,2.1,0,0,1,.21-1.52,28.93,28.93,0,0,0,1.52-7.55c.67-6.7.7-13.44.73-20.17A13.12,13.12,0,0,0,205.55,42.17Z"/><path class="top-row top-10 cls-2" d="M216,45c0-1.52,2.12-3.91,3.61-4.2a14.65,14.65,0,0,1,2.39,0,1.68,1.68,0,0,1,.81.1,1.21,1.21,0,0,1,.32.27,9.82,9.82,0,0,1,2.34,6.64,29.63,29.63,0,0,1-1.08,7.1L221.67,66.4a14.92,14.92,0,0,1-1,3.1,5,5,0,0,1-2.19,2.35,7.52,7.52,0,0,1-4,.32A1.11,1.11,0,0,1,214,72c-.41-.26-.32-.87-.19-1.33l1-3.21a30.85,30.85,0,0,0,1.29-5.43,32.88,32.88,0,0,0,.13-4.09Z"/><path class="bottom-row bottom-1 cls-3" d="M41.36,76.15c2.71-.43,5.43.54,7.91,1.62.54.24,1.15.59,1.15,1.13s-.41.79-.83,1c-1.71,1-3.83,1.3-5.55,2.29-2.89,1.67-4,4.93-4.8,8a47.62,47.62,0,0,0-1.49,8.92c-.1,1.85-.07,3.78-1,5.44L29.53,98a3.39,3.39,0,0,1-.76-.85,3,3,0,0,1,0-2l2.05-9.32c.48-2.19,1-4.47,2.57-6.2C35.26,77.54,38.37,76.63,41.36,76.15Z"/><path class="bottom-row bottom-2 cls-3" d="M49.1,78.66c.72-.7,2,.31,2.93.64,2.35.82,4.85,2.06,5.77,4.37a.85.85,0,0,1,.09.44c0,.54-.74.69-1.27.81a5.56,5.56,0,0,0-3.68,3.41A16.57,16.57,0,0,0,52,93.44l-1,12.81a4.59,4.59,0,0,1-.38,1.76,3.13,3.13,0,0,1-3.21,1.41A9.14,9.14,0,0,1,44,108a40,40,0,0,1-5.3-3.53,3.53,3.53,0,0,1-1.23-1.51,4,4,0,0,1,0-1.75l1.33-10.33c.29-2.18.63-4.5,2.11-6.13,1.25-1.38,3.1-2,4.72-2.94A21.55,21.55,0,0,0,49.1,78.66Z"/><path class="bottom-row bottom-3 cls-3" d="M57.67,84.43c2.42-2.05,6.41.17,9.24,1.61s5.39,4.11,5.47,7.31A12.93,12.93,0,0,1,72.05,96a27,27,0,0,0-.63,7.75,31.65,31.65,0,0,0,.83,4.21l1.9,7.77a8.2,8.2,0,0,1,.34,2.35,2.7,2.7,0,0,1-1,2.06,2.73,2.73,0,0,1-2.22.26,9.59,9.59,0,0,1-2.08-1c-4.9-2.77-10.29-4.55-15.24-7.2A6.86,6.86,0,0,1,51,109.81a5.93,5.93,0,0,1-.57-2.76c0-2.1.4-4.18.53-6.27.1-1.76,0-3.53.11-5.28a21.17,21.17,0,0,1,1.19-5.78,6.53,6.53,0,0,1,1.46-2.56C54.81,86.12,56.52,85.41,57.67,84.43Z"/><path class="bottom-row bottom-4 cls-3" d="M71.58,90.72c-.06-.89,2-1,2.84-1.07a102.17,102.17,0,0,1,17.32.5c1.59.23,3.3.61,4.3,1.87s1,3,.95,4.67c-.15,5.36,0,10.73.29,16.08a13.16,13.16,0,0,1-.06,3.26c-.59,3.06-3.35,5.25-4.42,8.18a2.81,2.81,0,0,1-.58,1.14,2.19,2.19,0,0,1-1.41.46c-3.78.19-7.3-1.82-11-2.4a7.39,7.39,0,0,1-1.94-.43c-1.36-.61-2-2.1-2.53-3.5-.7-2.06-1.19-4.18-1.68-6.29L72.43,108a25.89,25.89,0,0,1-1-6.53c0-1,.16-2,.24-3A51.3,51.3,0,0,0,71.58,90.72Z"/><path class="bottom-row bottom-5 cls-3" d="M96.83,93.84a3.15,3.15,0,0,1,1.38-2.38,2.71,2.71,0,0,1,1.1-.14l18.74.22a3.07,3.07,0,0,1,1.21.19,2.53,2.53,0,0,1,1,1.09,9.84,9.84,0,0,1,1.26,3.61,19.31,19.31,0,0,1,.11,2.95l-.22,18a9.6,9.6,0,0,1-.4,3.21c-.28.76-.74,1.44-1,2.2-.52,1.41-.44,3.12-1.47,4.21s-2.89,1.1-4.46,1L103.24,127a4.6,4.6,0,0,1-2.17-.55c-1.19-.77-1.42-2.39-1.61-3.8C99,119,98,115.52,97.4,111.93A62.35,62.35,0,0,1,96.83,93.84Z"/><path class="bottom-row bottom-6 cls-4" d="M121.68,93.49a2.31,2.31,0,0,1,.91-1.87,1.85,1.85,0,0,1,1.25-.3h18.4a4.55,4.55,0,0,1,1.91.27,4.31,4.31,0,0,1,1.77,1.84,9.25,9.25,0,0,1,1.2,2.59,20.33,20.33,0,0,1,.19,4.42c0,1.35.28,2.69.29,4a22.7,22.7,0,0,1-.37,3.76A95.54,95.54,0,0,1,145.16,119a39.08,39.08,0,0,0-1.39,5.72c-.11,1-.27,2.13-1.18,2.45a2.32,2.32,0,0,1-.79.09l-18.6-.14a1.14,1.14,0,0,1-.45-.06c-.36-.16-.46-.62-.5-1-.53-5.06.34-10.15.44-15.24,0-2.07,0-4.14-.13-6.21C122.42,101,122,97,121.68,93.49Z"/><path class="bottom-row bottom-7 cls-4" d="M145.24,92.05c-.24-.83,1.16-1.29,2-1.53a9.6,9.6,0,0,1,2.57-.26l8.88-.06a20.56,20.56,0,0,0,3.84-.27,13.41,13.41,0,0,1,2.43-.41c2.08,0,3.84,1.58,5.07,3.26a8.33,8.33,0,0,1,1.3,2.42,10.29,10.29,0,0,1,.13,4.14,116.57,116.57,0,0,1-5,24.71,2,2,0,0,1-.46.89,2.07,2.07,0,0,1-1,.46,47.05,47.05,0,0,1-8.54,1l-8,.43a.81.81,0,0,1-.53-.1.78.78,0,0,1-.22-.36l-2.15-5.59a7.22,7.22,0,0,1-.59-2.17,8.71,8.71,0,0,1,.88-3.43,27.26,27.26,0,0,0,1.45-11.38A59.12,59.12,0,0,0,145.24,92.05Z"/><path class="bottom-row bottom-8 cls-4" d="M168,91.33c-2.55-2,4.68-5,7.82-5.72a12.6,12.6,0,0,1,9.33,1.48,8.29,8.29,0,0,1,2.75,2.55A11.83,11.83,0,0,1,189,92.13a15.44,15.44,0,0,1,.82,3.21c.13,1.24,0,2.51.09,3.76a28.22,28.22,0,0,0,.63,3.52,66.16,66.16,0,0,1,.92,12.82,6.37,6.37,0,0,1-.5,3.07,5.94,5.94,0,0,1-3.28,2.34,44.8,44.8,0,0,1-15.42,3.06,1.46,1.46,0,0,1-.86-.16,1.56,1.56,0,0,1-.32-.36,14.83,14.83,0,0,1-2.61-4.83c-.8-3.11.37-6.34,1.16-9.45a41.27,41.27,0,0,0,1.27-8.92,16.5,16.5,0,0,0-.41-4.81A7.52,7.52,0,0,0,168,91.33Z"/><path class="bottom-row bottom-9 cls-4" d="M185.36,87.68c1.52,2.71,5.71-2.54,8.61-3.68a4.76,4.76,0,0,1,1.43-.4,4.12,4.12,0,0,1,2.35.83,16.72,16.72,0,0,1,6.72,8.46A32.19,32.19,0,0,1,205.78,99c.37,2.46.71,4.92,1,7.39a3.79,3.79,0,0,1-.18,2.29,3.68,3.68,0,0,1-.77.9,67.27,67.27,0,0,1-9,7.58,7.74,7.74,0,0,1-3.29,1.43,3.15,3.15,0,0,1-3.12-1.36c-.58-1-.31-2.3-.19-3.47a24,24,0,0,0-.39-5.8q-.94-6.14-2.07-12.24A25.41,25.41,0,0,0,185.36,87.68Z"/><path class="bottom-row bottom-10 cls-4" d="M196.83,84.12c3,1.47,5.52-4,8.85-3.83a13.48,13.48,0,0,1,8.82,4.26,18.8,18.8,0,0,1,4.55,8.8,12.82,12.82,0,0,1,.36,2.82,10.43,10.43,0,0,1-2.07,6,18,18,0,0,1-4.68,4.32c-1.57,1-3.39,2-5.25,1.67A.86.86,0,0,1,207,108a.88.88,0,0,1-.22-.49c-.2-1-.28-2.09-.42-3.13-.18-1.28-.44-2.55-.71-3.81L204.47,95a15.06,15.06,0,0,0-.73-2.65,12.77,12.77,0,0,0-1.55-2.55c-.78-1.06-1.61-2.09-2.48-3.08A12.29,12.29,0,0,0,196.83,84.12Z"/></svg>',
			teethImage = '<img src="/uploads/design/resources/images/paleo-teeth.jpg" />',
			builderHtml = '<div class="grill-builder-container">' + teethImage + svg + '</div>';

			$('.editor-content').insertBefore('.nested-columns');

			$(builderHtml).appendTo('.editor-content > .content-wrapper');

			var builder = $('#grill-builder-teeth');

			builder.find('path').on('click', function() {
				handleToothClick($(this));
			});

			var selectedTeeth = {
				'top': [false, false, false, false, false, false, false, false, false, false],
				'bottom': [false, false, false, false, false, false, false, false, false, false]
			};

			var dropdowns = $('.product_option-listbox select'),
			radios = $('.product_option-radio'),

			// top
			topTeeth = dropdowns.eq(0),
			topMetalSelector = dropdowns.eq(1).closest('.product_option-listbox'),
			topKaratSelector = dropdowns.eq(2).closest('.product_option-listbox'),
			topColorSelector = dropdowns.eq(3).closest('.product_option-listbox'),
			topRightFangSelector = dropdowns.eq(4).closest('.product_option-listbox'),
			topLeftFangSelector = dropdowns.eq(5).closest('.product_option-listbox'),

			// top bridge options
			freeTopBridge = dropdowns.eq(6).closest('.product_option-listbox'),
			paidTopBridge = dropdowns.eq(7).closest('.product_option-listbox'),
			gold10TopBridge = radios.eq(0),
			gold14TopBridge = radios.eq(1),
			gold18TopBridge = radios.eq(2),
			silverTopBridge = radios.eq(3),

			// top number of teeth options
			top10 = radios.eq(4),
			top14 = radios.eq(5),
			top18 = radios.eq(6),
			topSilver = radios.eq(7),

			// top doubles options
			topDoubles10 = radios.eq(8),
			topDoubles14 = radios.eq(9),
			topDoubles18 = radios.eq(10),
			topDoublesSilver = radios.eq(11),

			// bottom
			bottomTeeth = dropdowns.eq(8),
			bottomMetalSelector = dropdowns.eq(9).closest('.product_option-listbox'),
			bottomKaratSelector = dropdowns.eq(10).closest('.product_option-listbox'),
			bottomColorSelector = dropdowns.eq(11).closest('.product_option-listbox'),
			bottomRightFangSelector = dropdowns.eq(12).closest('.product_option-listbox'),
			bottomLeftFangSelector = dropdowns.eq(13).closest('.product_option-listbox'),

			// bottom bridge options
			freeBottomBridge = dropdowns.eq(14).closest('.product_option-listbox'),
			paidBottomBridge = dropdowns.eq(15).closest('.product_option-listbox'),
			gold10BottomBridge = radios.eq(12),
			gold14BottomBridge = radios.eq(13),
			gold18BottomBridge = radios.eq(14),
			silverBottomBridge = radios.eq(15),
			
			// bottom number of teeth options
			bottom10 = radios.eq(16),
			bottom14 = radios.eq(17),
			bottom18 = radios.eq(18),
			bottomSilver = radios.eq(19),

			// bottom doubles options
			bottomDoubles10 = radios.eq(20),
			bottomDoubles14 = radios.eq(21),
			bottomDoubles18 = radios.eq(22),
			bottomDoublesSilver = radios.eq(23),

			// general
			detailedInstructions = $('.product_option-long_text'),
			moldKit = dropdowns.eq(16).closest('.product_option-listbox'),
			additionalDiamonds = dropdowns.eq(17).closest('.product_option-listbox'),

			// defaults
			topMetal = 'gold',
			topKarat = '10k',
			topColor = 'yellow',
			bottomMetal = 'gold',
			bottomKarat = '10k',
			bottomColor = 'yellow',

			// fangs
			topRightFang = builder.find('.top-3'),
			topLeftFang = builder.find('.top-8'),
			bottomRightFang = builder.find('.bottom-3'),
			bottomLeftFang = builder.find('.bottom-8'),

			// add to cart button
			addToCart = $('.product-add');

			// remove first option from each dropdown ("Choose one (optional)") and trigger change
			dropdowns.each(function() {
				var _this = $(this);
				_this.find('option').first().remove();
				_this.find('option').first().prop('selected', true).removeAttr('selected');
				_this.find('select').change();
			});

			topMetalSelector.find('select').on('change', function() {
				var metal = $(this).find(':selected').html().toLowerCase(),
				color = (topMetalSelector.find(':selected').index() == 0 ? topColorSelector.find(':selected').html().toLowerCase() : 'silver');
				handleMetalChange(metal, true);
				handleColorChange(color, true);
			});

			bottomMetalSelector.find('select').on('change', function() {
				var metal = $(this).find(':selected').html().toLowerCase(),
				color = (topMetalSelector.find(':selected').index() == 0 ? topColorSelector.find(':selected').html().toLowerCase() : 'silver');
				handleMetalChange(metal, false);
				handleColorChange(color, false);
			});

			topKaratSelector.find('select').on('change', function() {
				var karat = $(this).find(':selected').html().toLowerCase();
				handleKaratChange(karat, true);
			});

			bottomKaratSelector.find('select').on('change', function() {
				var karat = $(this).find(':selected').html().toLowerCase();
				handleKaratChange(karat, false);
			});

			topColorSelector.find('select').on('change', function() {
				var color = $(this).find(':selected').html().toLowerCase();
				handleColorChange(color, true);
			});

			bottomColorSelector.find('select').on('change', function() {
				var color = $(this).find(':selected').html().toLowerCase();
				handleColorChange(color, false);
			});

			topRightFang.on('click', function() {
				if(topRightFang.hasClass('active')) {
					topRightFangSelector.addClass('active');
				} else {
					topRightFangSelector.removeClass('active');
					topRightFangSelector.find('select option').first().prop('selected', true).removeAttr('selected');
				}

				topRightFangSelector.find('select').change();
			});

			topLeftFang.on('click', function() {
				if(topLeftFang.hasClass('active')) {
					topLeftFangSelector.addClass('active');
				} else {
					topLeftFangSelector.removeClass('active');
					topLeftFangSelector.find('select option').first().prop('selected', true).removeAttr('selected');
				}

				topLeftFangSelector.find('select').change();
			});

			bottomRightFang.on('click', function() {
				if(bottomRightFang.hasClass('active')) {
					bottomRightFangSelector.addClass('active');
				} else {
					bottomRightFangSelector.removeClass('active');
					bottomRightFangSelector.find('select option').first().prop('selected', true).removeAttr('selected');
				}

				bottomRightFangSelector.find('select').change();
			});

			bottomLeftFang.on('click', function() {
				if(bottomLeftFang.hasClass('active')) {
					bottomLeftFangSelector.addClass('active');
				} else {
					bottomLeftFangSelector.removeClass('active');
					bottomLeftFangSelector.find('select option').first().prop('selected', true).removeAttr('selected');
				}

				bottomLeftFangSelector.find('select').change();
			});

			paidTopBridge.on('change', function() {
				bridgeCheck(true);
			});

			paidBottomBridge.on('change', function() {
				bridgeCheck(false);
			});

			// Section titles
			$('<h4 style="margin-top: 0;">Top Teeth</h4>').prependTo(topMetalSelector);
			$('<h4>Bottom Teeth</h4>').prependTo(bottomMetalSelector);
			detailedInstructions.find('.productOptionName').html('<h4>Detailed Instructions</h4><p>Provide any detailed instructions that will help us make your grill perfect.</p>');
			$('<h4>Mold Kit</h4>').prependTo(moldKit);
			additionalDiamonds.find('.productOptionName').html('<h4>Additional Diamond Setting</h4><p>Do you want us to follow up with you to discuss additional diamond setting and the associated costs?</p>');

			// Mold Kit
			$('<div class="moldkit-instructions"><p>Please ensure the mold of your teeth is with us. If it is not, please send it to:</p><p><strong>CJS Designs Inc.</strong></p><p><strong>305 - 9664 106 Ave NW</strong></p><p><strong>Edmonton, AB T5H 0N4</strong></p>').appendTo(moldKit);
			moldKitInstructions = moldKit.find('.moldkit-instructions');

			// // Show mold kit instructions if the mold kit is not required
			// moldKit.on('change', function() {
			// 	if($(this).find(':selected').html().toLowerCase() == 'no') {
			// 		moldKitInstructions.show();
			// 	} else {
			// 		moldKitInstructions.hide();
			// 	}
			// });

			/*
			* Toggle highlight on clicked tooth as well as visibility on applicable fields
			* 
			* @param object tooth
			* @return none
			*/
			function handleToothClick(tooth) {
				var isTop = tooth.hasClass('top-row');
				tooth.toggleClass('active');

				updateToothArray(isTop);
				handleTeethNumbers(isTop);
				bridgeCheck(isTop);

				// show applicable inputs
				if($('.top-row.active').length) {
					topMetalSelector.show();

					if(topMetalSelector.find(':selected').index() == 0) {
						topKaratSelector.show();
						topColorSelector.show();
					}
				} else {
					topMetalSelector.hide();
					topKaratSelector.hide();
					topColorSelector.hide();
				}

				if($('.bottom-row.active').length) {
					bottomMetalSelector.show();

					if(bottomMetalSelector.find(':selected').index() == 0) {
						bottomKaratSelector.show();
						bottomColorSelector.show();
					}
				} else {
					bottomMetalSelector.hide();
					bottomKaratSelector.hide();
					bottomColorSelector.hide();
				}

				if(builder.find('.active').length) {
					detailedInstructions.show();
					moldKit.show();
					additionalDiamonds.show();
					addToCart.show();
				} else {
					detailedInstructions.hide();
					moldKit.hide();
					moldKit.find('select option').first().prop('selected', true).removeAttr('selected').change();
					additionalDiamonds.hide();
					addToCart.hide();
				}
			}
			
			/*
			* Update status of selectedTeeth array, where true means the tooth is selected and false means the tooth is unselected
			* 
			* @param bool isTop
			* @return none
			*/
			function updateToothArray(isTop) {
				builder.find('.' + (isTop ? 'top' : 'bottom') + '-row').each(function(index) {
					// set position in selectedTeeth array to true or false based on whether or not the tooth is selected
					selectedTeeth[(isTop ? 'top' : 'bottom')][index] = $(this).hasClass('active');
				});
			}
			
			/*
			* Calculates the number of gaps and total teeth in gaps, shows the applicable bridge dropdowns,
			* and updates the bridge radio buttons if a bridge is required
			* 
			* @param bool isTop
			* @return none
			*/
			function bridgeCheck(isTop) {
				var gaps = 0,
				teethSkipped = 0,
				gapStart = -1,
				row = (isTop ? 'top' : 'bottom'),
				activeTeeth = builder.find('.' + row + '-row.active').length,
				free = (((isTop && topMetal != 'silver') || (!isTop && bottomMetal != 'silver')) && activeTeeth == 2 ? true : false);

				if(activeTeeth) {
					selectedTeeth[row].forEach(function(e, index) {
						if(e !== false) {
							// if not first tooth
							if(index > 0) {
								// if gapStart is set and previous tooth is a gap
								if(gapStart > -1 && !selectedTeeth[row][index - 1]) {
									teethSkipped += (index - gapStart - 1);
									gaps += 1;

									// end gap
									gapStart = -1;
								}
							}

							// if not the last tooth
							if(index < selectedTeeth[row].length - 1) {
								// if next tooth isn't selected
								if(!selectedTeeth[row][index + 1]) {
									gapStart = index;
								} else {
									gapStart = index + 1;
								}
							}
						}
					});

					// show appropriate kit
					if(teethSkipped > 0) {
						if(isTop) {
							if(free) {
								freeTopBridge.show();
								paidTopBridge.hide();

								resetBridgeOptions(isTop);
							} else {
								freeTopBridge.hide();
								paidTopBridge.show();
							}
						} else {
							if(free) {
								freeBottomBridge.show();
								paidBottomBridge.hide();

								resetBridgeOptions(isTop);
							} else {
								freeBottomBridge.hide();
								paidBottomBridge.show();
							}
						}
					} else {
						freeTopBridge.hide();
						paidTopBridge.hide();
						freeBottomBridge.hide();
						paidBottomBridge.hide();

						resetBridgeOptions(isTop);
					}

					handleBridgeChange(teethSkipped, free, isTop);
				}

				if(activeTeeth == 2 && gaps == 0) {
					handleDoubles(isTop);
				}
			}

			/*
			* Resets the bridge options when the bridge is free or not required
			* 
			* @param bool isTop
			* @return none
			*/
			function resetBridgeOptions(isTop) {
				if(isTop) {
					freeTopBridge.find('select option').first().prop('selected', true).removeAttr('selected');
					paidTopBridge.find('select option').first().prop('selected', true).removeAttr('selected');
					gold10TopBridge.last().prop('checked', true).removeAttr('checked').change();
					gold14TopBridge.last().prop('checked', true).removeAttr('checked').change();
					gold18TopBridge.last().prop('checked', true).removeAttr('checked').change();
					silverTopBridge.last().prop('checked', true).removeAttr('checked').change();
				} else {
					freeBottomBridge.find('select option').first().prop('selected', true).removeAttr('selected');
					paidBottomBridge.find('select option').first().prop('selected', true).removeAttr('selected');
					gold10BottomBridge.last().prop('checked', true).removeAttr('checked').change();
					gold14BottomBridge.last().prop('checked', true).removeAttr('checked').change();
					gold18BottomBridge.last().prop('checked', true).removeAttr('checked').change();
					silverBottomBridge.last().prop('checked', true).removeAttr('checked').change();
				}
			}
			
			/*
			* Selects the correct bridge options based on metal, karat, and the number of skipped teeth
			* 
			* @param int teethSkipped
			* @param bool free
			* @param bool isTop
			* @return none
			*/
			function handleBridgeChange(teethSkipped, free, isTop) {
				if(isTop) {
					gold10TopBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					gold14TopBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					gold18TopBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					silverTopBridge.find('input').last().prop('checked', true).removeAttr('checked').change();

					if(!free && paidTopBridge.find(':selected').html().toLowerCase() == 'yes') {
						if(topMetal == 'gold') {
							switch(topKarat) {
								case '10k':
									gold10TopBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
								case '14k':
									gold14TopBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
								case '18k':
									gold18TopBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
							}
						} else if(topMetal == 'silver') {
							silverTopBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
						}
					}
				} else {
					gold10BottomBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					gold14BottomBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					gold18BottomBridge.find('input').last().prop('checked', true).removeAttr('checked').change();
					silverBottomBridge.find('input').last().prop('checked', true).removeAttr('checked').change();

					if(!free && paidBottomBridge.find(':selected').html().toLowerCase() == 'yes') {
						if(bottomMetal == 'gold') {
							switch(bottomKarat) {
								case '10k':
									gold10BottomBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
								case '14k':
									gold14BottomBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
								case '18k':
									gold18BottomBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
									break;
							}
						} else if(bottomMetal == 'silver') {
							silverBottomBridge.find('input').eq(teethSkipped - 1).prop('checked', true).change();
						}
					}
				}
			}
			
			/*
			* Changes metal variable and updates teeth and bridge fields based on the selected metal
			* 
			* @param string metal
			* @param bool isTop
			* @return none
			*/
			function handleMetalChange(metal, isTop) {
				if(isTop) {
					topMetal = metal;

					if(metal == 'silver') {
						topKaratSelector.find('option').first().prop('selected', true).removeAttr('selected');
						topKaratSelector.hide();
						topColorSelector.hide();
					} else {
						topKaratSelector.show();
						topColorSelector.show();
					}
				} else {
					bottomMetal = metal;

					if(metal == 'silver') {
						bottomKaratSelector.find('option').first().prop('selected', true).removeAttr('selected');
						bottomKaratSelector.hide();
						bottomColorSelector.hide();
					} else {
						bottomKaratSelector.show();
						bottomColorSelector.show();
					}
				}

				handleTeethNumbers(isTop);
				bridgeCheck(isTop);
			}
			
			/*
			* Changes karat variable and updates teeth and bridge fields based on the selected metal
			* 
			* @param string karat
			* @param bool isTop
			* @return none
			*/
			function handleKaratChange(karat, isTop) {
				if(isTop) {
					topKarat = karat;
				} else {
					bottomKarat = karat;
				}

				handleTeethNumbers(isTop);
				bridgeCheck(isTop);
			}
			
			/*
			* Changes SVG class as well as the color variable
			* 
			* @param string color
			* @param bool isTop
			* @return none
			*/
			function handleColorChange(color, isTop) {
				if(isTop) {
					builder.removeClass('top-yellow top-white top-rose top-silver');
					topColor = color;
				} else {
					builder.removeClass('bottom-yellow bottom-white bottom-rose bottom-silver');
					bottomColor = color;
				}

				builder.addClass((isTop ? 'top' : 'bottom') + '-' + color);
			}
			
			/*
			* Selects the correct number of teeth options based on metal, karat, and the number of selected teeth
			* 
			* @param bool isTop
			* @return none
			*/
			function handleTeethNumbers(isTop) {
				if(isTop) {
					top10.find('input').last().prop('checked', true).removeAttr('checked').change();
					top14.find('input').last().prop('checked', true).removeAttr('checked').change();
					top18.find('input').last().prop('checked', true).removeAttr('checked').change();
					topSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					topDoubles10.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoubles14.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoubles18.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoublesSilver.find('input').last().prop('checked', true).removeAttr('checked').change();
					
					if(topMetal == 'gold') {
						switch(topKarat) {
							case '10k':
								top10.find('input').eq(builder.find('.top-row.active').length - 1).prop('checked', true).change();
								break;
							case '14k':
								top14.find('input').eq(builder.find('.top-row.active').length - 1).prop('checked', true).change();
								break;
							case '18k':
								top18.find('input').eq(builder.find('.top-row.active').length - 1).prop('checked', true).change();
								break;
						}
					} else if(topMetal == 'silver') {
						topSilver.find('input').eq(builder.find('.top-row.active').length - 1).prop('checked', true).change();
					}
				} else {
					bottom10.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottom14.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottom18.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					bottomDoubles10.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoubles14.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoubles18.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoublesSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					if(bottomMetal == 'gold') {
						switch(bottomKarat) {
							case '10k':
								bottom10.find('input').eq(builder.find('.bottom-row.active').length - 1).prop('checked', true).change();
								break;
							case '14k':
								bottom14.find('input').eq(builder.find('.bottom-row.active').length - 1).prop('checked', true).change();
								break;
							case '18k':
								bottom18.find('input').eq(builder.find('.bottom-row.active').length - 1).prop('checked', true).change();
								break;
						}
					} else if(bottomMetal == 'silver') {
						bottomSilver.find('input').eq(builder.find('.bottom-row.active').length - 1).prop('checked', true).change();
					}
				}
			}

			/*
			* If the selected grills are doubles (only two teeth with no gap) deselect the number of teeth
			* and select the appropriate doubles
			* 
			* @param bool isTop
			* @return none
			*/
			function handleDoubles(isTop) {
				if(isTop) {
					top10.find('input').last().prop('checked', true).removeAttr('checked').change();
					top14.find('input').last().prop('checked', true).removeAttr('checked').change();
					top18.find('input').last().prop('checked', true).removeAttr('checked').change();
					topSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					topDoubles10.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoubles14.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoubles18.find('input').last().prop('checked', true).removeAttr('checked').change();
					topDoublesSilver.find('input').last().prop('checked', true).removeAttr('checked').change();
					
					if(topMetal == 'gold') {
						switch(topKarat) {
							case '10k':
								topDoubles10.find('input').first().prop('checked', true).change();
								break;
							case '14k':
								topDoubles14.find('input').first().prop('checked', true).change();
								break;
							case '18k':
								topDoubles18.find('input').first().prop('checked', true).change();
								break;
						}
					} else if(topMetal == 'silver') {
						topDoublesSilver.find('input').first().prop('checked', true).change();
					}
				} else {
					bottom10.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottom14.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottom18.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					bottomDoubles10.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoubles14.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoubles18.find('input').last().prop('checked', true).removeAttr('checked').change();
					bottomDoublesSilver.find('input').last().prop('checked', true).removeAttr('checked').change();

					if(bottomMetal == 'gold') {
						switch(bottomKarat) {
							case '10k':
								bottomDoubles10.find('input').first().prop('checked', true).change();
								break;
							case '14k':
								bottomDoubles14.find('input').first().prop('checked', true).change();
								break;
							case '18k':
								bottomDoubles18.find('input').first().prop('checked', true).change();
								break;
						}
					} else if(bottomMetal == 'silver') {
						bottomDoublesSilver.find('input').first().prop('checked', true).change();
					}
				}
			}
		}
	});
})(jQuery);